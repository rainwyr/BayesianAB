---
title: "Bayesian A/B Testing Tutorial"
author: "Rain Wang"
date: "2/13/2021"
output:
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo=FALSE, message=FALSE}
library(knitr)
library(bayesAB)
library(ggplot2)
library(gridExtra)
```

# Binary

### Data

* A is simulated from 250 binomial data points with p=0.3.
* B is simulated from 250 binomial data points with p=0.2.

```{r, echo=FALSE, fig.height=6, fig.width=15}
A_binom <- rbinom(250, 1, .3)
B_binom <- rbinom(250, 1, .2)
par(mfrow=c(1,2))
kable(table(A_binom))
kable(table(B_binom))
```

### Prior Distribution

* Parameter = Probability
* Probability ~ Beta(a, b)

### Test Result

```{r, echo=FALSE, fig.height=6, fig.width=15}
AB1 <- bayesTest(
  A_binom, 
  B_binom, 
  priors = c('alpha' = 65, 'beta' = 200), 
  n_samples = 1e5, 
  distribution = 'bernoulli')
percLift = 5
s1 = summary(AB1, percentLift = percLift)
```

The probability of P(A > B) by `r percLift`% is `r round(s1$probability$Probability,2)`.

`r s1$credInt*100`% credible interval of (A - B) = (`r round(s1$interval$Probability[1],2)`, `r round(s1$interval$Probability[2],2)`).

Posterior Expected Loss of choosing B over A = `r round(s1$posteriorExpectedLoss$Probability,2)`.

### Summary

```{r, echo=FALSE, fig.height=6, fig.width=15}
plot(AB1, percentLift = percLift)
```

# Poisson

### Data

* A is simulated from 250 poisson data points with lambda=6.
* B is simulated from 250 poisson data points with lambda=6.

```{r, echo=FALSE, fig.height=6, fig.width=15}
A_pois <- rpois(250, 6)
B_pois <- rpois(250, 6)
par(mfrow=c(1,2))
grid.arrange(
  qplot(A_pois, bins = 10) + ggtitle("Histogram of A Data"),
  qplot(B_pois, bins = 10) + ggtitle("Histogram of B Data"),
  nrow=1)
```

### Prior Distribution

* Parameter = Lambda
* Lambda ~ Gamma(a, b)

### Test Result

```{r, echo=FALSE, fig.height=6, fig.width=15}
AB2 <- bayesTest(
  A_pois, 
  B_pois, 
  priors = c('shape' = 30, 'rate' = 5), 
  n_samples = 1e5, 
  distribution = 'poisson')
percLift = 1
s2 = summary(AB2, percentLift = percLift)
```
             
The probability of P(A > B) by `r percLift`% is `r round(s2$probability$Lambda,2)`.

`r s2$credInt*100`% credible interval of (A - B) = (`r round(s2$interval$Lambda[1],2)`, `r round(s2$interval$Lambda[2],2)`).

Posterior Expected Loss of choosing B over A = `r round(s2$posteriorExpectedLoss$Lambda,2)`.

### Summary

```{r, echo=FALSE, fig.height=6, fig.width=15}
plot(AB2, percentLift = percLift)#$posteriors
```
